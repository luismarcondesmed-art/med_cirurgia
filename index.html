<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma Interativo de Estágio em Cirurgia - 10 Semanas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            color-scheme: dark;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .activity-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, opacity 0.3s, background-color 0.3s;
        }
        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .activity-card.checked {
            opacity: 0.65;
            background-color: #3a3a3a;
        }
        .activity-card.checked .activity-title {
            text-decoration: line-through;
            color: #888;
        }
        .activity-title {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: .65em auto;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23F3F3F3%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
        }
        #schedule-grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        /* Custom scrollbar for webkit browsers */
        aside::-webkit-scrollbar, main::-webkit-scrollbar {
            width: 8px;
        }
        aside::-webkit-scrollbar-track, main::-webkit-scrollbar-track {
            background: #2B2B2B;
        }
        aside::-webkit-scrollbar-thumb, main::-webkit-scrollbar-thumb {
            background-color: #4A4A4A;
            border-radius: 10px;
            border: 2px solid #2B2B2B;
        }
        /* Animation for mobile menu */
        #sidebar-overlay {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            visibility: hidden;
            opacity: 0;
        }
        #sidebar-overlay.is-open {
            visibility: visible;
            opacity: 1;
        }
        #sidebar-mobile {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: scale(0.95);
            opacity: 0;
        }
        #sidebar-overlay.is-open #sidebar-mobile {
            transform: scale(1);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-[#1B1B1B] text-[#F3F3F3]">

    <div class="flex flex-col h-screen">
        <header class="text-center p-4 relative border-b border-gray-700 bg-[#2B2B2B] flex-shrink-0 flex items-center justify-center">
            <button id="sidebar-toggle" class="lg:hidden absolute left-4 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
            <h1 class="text-2xl md:text-3xl font-bold">Cronograma de Estágio</h1>
        </header>

        <div class="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-8 lg:p-8 overflow-hidden">
            <!-- Sidebar for desktop -->
            <aside id="sidebar-desktop" class="hidden lg:flex lg:col-span-3 flex-col gap-8 overflow-y-auto p-4 sm:p-6 lg:p-0">
                 <div class="p-6 bg-[#2B2B2B] rounded-lg shadow-lg flex flex-col gap-2">
                    <label for="week-selector-desktop" class="block text-sm font-medium text-center mb-2">Selecione a Semana</label>
                    <select id="week-selector-desktop" class="w-full p-3 bg-[#2D2D2D] border border-gray-600 rounded-md shadow-sm focus:ring-[#2899F5] focus:border-[#2899F5]"></select>
                    <p id="schedule-subtitle-desktop" class="text-sm text-gray-400 mt-2 text-center"></p>
                </div>
                <div class="bg-[#2B2B2B] p-6 rounded-lg shadow-lg text-center">
                    <h3 class="text-lg font-semibold mb-4">Selecione o Aluno</h3>
                    <img id="student-image-desktop" src="https://i.imgur.com/5AW2oEL.png" alt="Foto do Grupo" class="w-full h-auto mx-auto rounded-lg object-cover border-4 border-gray-600 mb-4">
                    <select id="student-selector-desktop" class="w-full p-3 bg-[#2D2D2D] border border-gray-600 rounded-md shadow-sm focus:ring-[#2899F5] focus:border-[#2899F5]"></select>
                </div>
                 <div class="bg-[#2B2B2B] p-6 rounded-lg shadow-lg text-center">
                    <h3 class="text-lg font-semibold mb-4">Opções</h3>
                    <button id="clearWeekButton-desktop" class="w-full mt-4 p-2 bg-red-600 hover:bg-red-700 rounded-md font-semibold transition-colors text-white text-sm">Limpar marcações da semana</button>
                </div>
            </aside>

            <main id="main-content" class="col-span-12 lg:col-span-9 overflow-y-auto p-4 sm:p-6 lg:p-0">
                <!-- Week Selector for Mobile - Scrolls with content -->
                <div class="p-4 bg-[#2B2B2B] border border-gray-700 rounded-lg mb-6 lg:hidden">
                    <label for="week-selector-mobile" class="block text-sm font-medium text-center mb-2">Selecione a Semana</label>
                    <select id="week-selector-mobile" class="w-full p-3 bg-[#2D2D2D] border border-gray-600 rounded-md shadow-sm focus:ring-[#2899F5] focus:border-[#2899F5]"></select>
                    <p id="schedule-subtitle-mobile" class="text-sm text-gray-400 mt-2 text-center"></p>
                </div>
                <div id="schedule-grid" class="gap-4"></div>
                 <!-- Loading Indicator -->
                <div id="loading-indicator" class="flex items-center justify-center h-full">
                    <p class="text-gray-400">Carregando cronograma...</p>
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile Floating Menu -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-70 z-40 flex items-center justify-center p-4">
        <aside id="sidebar-mobile" class="relative w-full max-w-sm bg-[#2B2B2B] rounded-2xl shadow-2xl flex flex-col gap-8 p-6 overflow-y-auto max-h-[90vh]">
            <button id="sidebar-close" class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-700">
                 <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="bg-[#2B2B2B] rounded-lg text-center">
                <h3 class="text-lg font-semibold mb-4">Selecione o Aluno</h3>
                <img id="student-image-mobile" src="https://i.imgur.com/5AW2oEL.png" alt="Foto do Grupo" class="w-full h-auto mx-auto rounded-lg object-cover border-4 border-gray-600 mb-4">
                <select id="student-selector-mobile" class="w-full p-3 bg-[#2D2D2D] border border-gray-600 rounded-md shadow-sm focus:ring-[#2899F5] focus:border-[#2899F5]"></select>
            </div>
             <div class="bg-[#2B2B2B] rounded-lg text-center">
                <h3 class="text-lg font-semibold mb-4">Opções</h3>
                <button id="clearWeekButton-mobile" class="w-full mt-4 p-2 bg-red-600 hover:bg-red-700 rounded-md font-semibold transition-colors text-white text-sm">Limpar marcações da semana</button>
            </div>
        </aside>
    </div>

    <script>
        // --- CONFIGURAÇÃO DO CICLO ---
        // Altere esta data para o dia de início do estágio para criar um novo ciclo de salvamento.
        const CYCLE_START_DATE = '2025-08-25';

        document.addEventListener('DOMContentLoaded', async () => {
            let currentWeek = 1;
            let currentStudent = 'all';
            let checklistData = {};
            let scheduleData = [];

            const LOCAL_STORAGE_KEY_CHECKLIST = `cronogramaChecklistData_${CYCLE_START_DATE}`;
            const LOCAL_STORAGE_KEY_STUDENT = `cronogramaLastStudent_${CYCLE_START_DATE}`;

            const students = [
                { id: 'all', name: 'Todos os Ratos', imageUrl: 'https://i.imgur.com/5AW2oEL.png' },
                { id: 1, name: 'Big', imageUrl: 'https://i.imgur.com/RaVjIKr.png' },
                { id: 2, name: 'Jerso', imageUrl: 'https://i.imgur.com/Rc1FxGy.png' },
                { id: 3, name: 'Negão', imageUrl: 'https://i.imgur.com/3jRzf17.png' },
                { id: 4, name: 'Marcondes', imageUrl: 'https://i.imgur.com/Yy1mHjs.png' },
                { id: 5, name: 'Lyan', imageUrl: 'https://i.imgur.com/BftVHjo.png' },
            ];

            const weeks = [
                { id: 1, title: 'CIPE', dates: '25/08/25 a 31/08/25' },
                { id: 2, title: 'MULTI(Cardiovascular, Vascular e Neuro)', dates: '01/09/25 a 07/09/25' },
                { id: 3, title: 'COLOPROCTO', dates: '08/09/25 a 14/09/25' },
                { id: 4, title: 'CX PLÁSTICA', dates: '15/09/25 a 21/09/25' },
                { id: 5, title: 'CLÍNICA CIRÚRGICA 1', dates: '22/09/25 a 28/09/25' },
                { id: 6, title: 'CLÍNICA CIRÚRGICA 2', dates: '29/09/25 a 05/10/25' },
                { id: 7, title: 'ORTOPEDIA 1', dates: '06/10/25 a 12/10/25' },
                { id: 8, title: 'ORTOPEDIA 2', dates: '13/10/25 a 19/10/25' },
                { id: 9, title: 'UROLOGIA 1', dates: '20/10/25 a 26/10/25' },
                { id: 10, title: 'UROLOGIA 2', dates: '27/10/25 a 01/11/25' },
            ];
            
            const scheduleGrid = document.getElementById('schedule-grid');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            const weekSelectorMobile = document.getElementById('week-selector-mobile');
            const scheduleSubtitleMobile = document.getElementById('schedule-subtitle-mobile');
            const studentSelectorMobile = document.getElementById('student-selector-mobile');
            const studentImageMobile = document.getElementById('student-image-mobile');
            const clearWeekButtonMobile = document.getElementById('clearWeekButton-mobile');

            const weekSelectorDesktop = document.getElementById('week-selector-desktop');
            const scheduleSubtitleDesktop = document.getElementById('schedule-subtitle-desktop');
            const studentSelectorDesktop = document.getElementById('student-selector-desktop');
            const studentImageDesktop = document.getElementById('student-image-desktop');
            const clearWeekButtonDesktop = document.getElementById('clearWeekButton-desktop');
            
            const daysOfWeek = ['SEGUNDA', 'TERÇA', 'QUARTA', 'QUINTA', 'SEXTA', 'SÁBADO', 'DOMINGO'];
            
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarClose = document.getElementById('sidebar-close');

            function toggleSidebar() {
                sidebarOverlay.classList.toggle('is-open');
            }

            sidebarToggle.addEventListener('click', toggleSidebar);
            sidebarClose.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', (e) => {
                if (e.target === sidebarOverlay) {
                    toggleSidebar();
                }
            });

            function loadChecklistData() {
                const data = localStorage.getItem(LOCAL_STORAGE_KEY_CHECKLIST);
                checklistData = data ? JSON.parse(data) : {};
            }

            function saveChecklistData() {
                localStorage.setItem(LOCAL_STORAGE_KEY_CHECKLIST, JSON.stringify(checklistData));
            }

            function loadLastStudent() {
                const savedStudent = localStorage.getItem(LOCAL_STORAGE_KEY_STUDENT);
                if (savedStudent) {
                    currentStudent = savedStudent;
                }
            }

            function saveLastStudent() {
                localStorage.setItem(LOCAL_STORAGE_KEY_STUDENT, currentStudent);
            }

            function populateSelectors() {
                weeks.forEach(week => {
                    const option1 = document.createElement('option');
                    option1.value = week.id;
                    option1.textContent = `Semana ${week.id}: ${week.title}`;
                    weekSelectorMobile.appendChild(option1);

                    const option2 = document.createElement('option');
                    option2.value = week.id;
                    option2.textContent = `Semana ${week.id}: ${week.title}`;
                    weekSelectorDesktop.appendChild(option2);
                });

                students.forEach(student => {
                    const option1 = document.createElement('option');
                    option1.value = student.id;
                    option1.textContent = student.name;
                    studentSelectorMobile.appendChild(option1);

                    const option2 = document.createElement('option');
                    option2.value = student.id;
                    option2.textContent = student.name;
                    studentSelectorDesktop.appendChild(option2);
                });

                studentSelectorMobile.value = currentStudent;
                studentSelectorDesktop.value = currentStudent;
            }

            function syncSelectors(source, target) {
                 target.value = source.value;
            }

            function handleWeekChange(e) {
                syncSelectors(e.target, e.target.id === 'week-selector-mobile' ? weekSelectorDesktop : weekSelectorMobile);
                currentWeek = parseInt(e.target.value);
                updateView();
            }

            weekSelectorMobile.addEventListener('change', handleWeekChange);
            weekSelectorDesktop.addEventListener('change', handleWeekChange);

            function handleStudentChange(e) {
                const isMobile = e.target.id === 'student-selector-mobile';
                const otherSelector = isMobile ? studentSelectorDesktop : studentSelectorMobile;
                syncSelectors(e.target, otherSelector);
                
                currentStudent = e.target.value;
                saveLastStudent();

                const selectedStudent = students.find(s => s.id == currentStudent);
                studentImageMobile.src = selectedStudent.imageUrl;
                studentImageMobile.alt = `Foto de ${selectedStudent.name}`;
                studentImageDesktop.src = selectedStudent.imageUrl;
                studentImageDesktop.alt = `Foto de ${selectedStudent.name}`;
                
                renderSchedule(currentWeek, currentStudent);
                
                if (isMobile) {
                    toggleSidebar();
                }
            }

            studentSelectorMobile.addEventListener('change', handleStudentChange);
            studentSelectorDesktop.addEventListener('change', handleStudentChange);
            
            function handleChecklistChange(event) {
                const checkbox = event.target;
                const card = checkbox.closest('.activity-card');
                const activityId = checkbox.id;
                
                checklistData[activityId] = checkbox.checked;
                if (checkbox.checked) {
                    card.classList.add('checked');
                } else {
                    card.classList.remove('checked');
                }
                saveChecklistData();
            }

            function renderSchedule(selectedWeek, selectedStudentId) {
                const weekData = scheduleData.filter(item => item.week === selectedWeek);
                
                let daysToRender = [];
                daysOfWeek.forEach(day => {
                    const hasActivities = weekData.some(item => item.day === day && (selectedStudentId === 'all' || item.studentId.includes(parseInt(selectedStudentId))));
                    if (hasActivities) {
                        daysToRender.push(day);
                    }
                });
                
                scheduleGrid.innerHTML = '';

                daysToRender.forEach(day => {
                    const activitiesForDay = weekData
                        .filter(item => item.day === day)
                        .filter(item => selectedStudentId === 'all' || item.studentId.includes(parseInt(selectedStudentId)))
                        .sort((a, b) => a.time.localeCompare(b.time));

                    const dayColumn = document.createElement('div');
                    dayColumn.className = 'flex flex-col gap-4';

                    const dayHeader = document.createElement('h2');
                    dayHeader.className = 'text-xl font-bold text-center p-3 bg-[#2D2D2D] rounded-lg shadow-sm';
                    dayHeader.textContent = day.charAt(0) + day.slice(1).toLowerCase();
                    dayColumn.appendChild(dayHeader);

                    if (activitiesForDay.length > 0) {
                        activitiesForDay.forEach((item, index) => {
                            const sanitizedTime = item.time.replace(/[\s:-]/g, '');
                            const sanitizedActivity = item.activity.replace(/[^a-zA-Z0-9]/g, '').substring(0, 10);
                            const activityId = `week-${selectedWeek}-day-${day}-time-${sanitizedTime}-activity-${sanitizedActivity}`;
                            const isChecked = checklistData[activityId] || false;

                            const card = document.createElement('div');
                            card.className = `activity-card rounded-lg p-4 border-l-4 shadow-md bg-[#2D2D2D] border-[#2899F5] ${isChecked ? 'checked' : ''}`;

                            let involvedStudents = 'Todos';
                            if (item.studentId.length < students.length - 1) { 
                                involvedStudents = students
                                    .filter(s => s.id !== 'all' && item.studentId.includes(s.id))
                                    .map(s => s.name.split(' ')[0])
                                    .join(', ');
                            }
                            
                            card.innerHTML = `
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <p class="font-bold text-md activity-title">${item.activity}</p>
                                        <p class="text-sm text-gray-400 font-medium mt-1">${item.time}</p>
                                    </div>
                                    <input type="checkbox" id="${activityId}" class="ml-4 mt-1 h-5 w-5 rounded bg-gray-700 border-gray-600 text-blue-500 focus:ring-blue-600" ${isChecked ? 'checked' : ''}>
                                </div>
                                <div class="mt-3 border-t border-gray-700 pt-3 text-sm">
                                    <p><strong>Professor:</strong> ${item.professor}</p>
                                    <p><strong>Local:</strong> ${item.location}</p>
                                    <p class="mt-2 text-xs text-gray-500"><strong>Alunos:</strong> ${involvedStudents}</p>
                                </div>
                            `;
                            dayColumn.appendChild(card);
                            card.querySelector(`#${activityId}`).addEventListener('change', handleChecklistChange);
                        });
                    } else {
                         const noActivityCard = document.createElement('div');
                         noActivityCard.className = 'text-center p-4 text-gray-500 bg-gray-800/50 border border-dashed border-gray-700 rounded-lg h-full flex items-center justify-center';
                         noActivityCard.textContent = 'Nenhuma atividade.';
                         dayColumn.appendChild(noActivityCard);
                    }
                    scheduleGrid.appendChild(dayColumn);
                });
            }
            
            function updateView() {
                const selectedWeekData = weeks.find(w => w.id === currentWeek);
                const subtitleText = `${selectedWeekData.title} (${selectedWeekData.dates})`;
                scheduleSubtitleMobile.textContent = subtitleText;
                scheduleSubtitleDesktop.textContent = subtitleText;
                
                const selectedStudent = students.find(s => s.id == currentStudent);
                if (selectedStudent) {
                    studentImageMobile.src = selectedStudent.imageUrl;
                    studentImageDesktop.src = selectedStudent.imageUrl;
                }

                renderSchedule(currentWeek, currentStudent);
            }
            
            async function main() {
                try {
                    const response = await fetch('schedule.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    scheduleData = await response.json();
                    
                    loadingIndicator.style.display = 'none'; // Hide loading
                    
                    loadChecklistData();
                    loadLastStudent();
                    populateSelectors();
                    updateView();
                } catch (error) {
                    loadingIndicator.textContent = 'Falha ao carregar o cronograma. Verifique o console para mais detalhes.';
                    console.error("Could not fetch schedule data:", error);
                }
            }

            function clearWeekData() {
                const prefix = `week-${currentWeek}-`;
                let needsUpdate = false;

                for (const key in checklistData) {
                    if (key.startsWith(prefix)) {
                        delete checklistData[key];
                        needsUpdate = true;
                    }
                }

                if (needsUpdate) {
                    saveChecklistData();
                    renderSchedule(currentWeek, currentStudent);
                }
            }

            clearWeekButtonMobile.addEventListener('click', clearWeekData);
            clearWeekButtonDesktop.addEventListener('click', clearWeekData);

            main();
        });
    </script>
</body>
</html>
